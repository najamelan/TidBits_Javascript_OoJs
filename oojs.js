/*
 TidBits OoJs - version: 13.08.20-alpha
 README: https://github.com/najamelan/TidBits_Javascript_OoJs
*/
var TidBits=TidBits||{};
(function(x,p){function s(a,c){this.classID=a;this.type=c;this.table={}}function G(a,c,d,b,e){this.Static=c;this.IFace=e;this.Class=a[d];this.name=d;this.id=b;this.bases=[];this.allBases=[];this.accessibleBases=[];this.inaccessibleBases=[];this.friends=[];this.staticLayout=new s(c.ooID,"staticLayout");this.instanceLayout=new s(c.ooID,"instanceLayout");this.layoutInstance=null;this.flags=0;this.virtuals={};this.namespace=a}function y(a,c,d){this._this=a;this.classID=c;this.iFace=d;this.state={};this.supers=
[];this.flags=0}function t(){return null}function H(a,c,d){function b(){}function e(){}var f=a[c];Object.defineProperty(b,"Public",{value:z});Object.defineProperty(b,"Protected",{value:A});Object.defineProperty(b,"Private",{value:B});Object.defineProperty(b,"Friends",{value:I});Object.defineProperty(b,"getPrivateInstance",{value:J});Object.defineProperty(b,"ooID",{value:u()});Object.defineProperty(f,"ooID",{value:b.ooID});Object.defineProperty(b,"toString",{value:function(){return"function Static(){ /*"+
c+"*/ }"}});Object.defineProperty(f,"toString",{value:function(){return"function "+c+"()"}});k[b.ooID]=new G(a,b,c,b.ooID,e);l[b.ooID]=new y(b,b.ooID,f);n[c]=b.ooID;if(d!==p){Array.isArray(d)||(d=Array(d));for(var h=d.length-1;0<=h;--h){var g={as:"private",namespace:a};"string"===typeof d[h]&&(d[h]={inherit:d[h]});d[h]=q(g,d[h]);if(0>["public","private","protected"].indexOf(d[h].as))throw Error("Invalid class access level in class: "+c+". Trying to inherit "+d[h].inherit+" as "+d[h].as+". Only 'public', 'private' or 'protected' are supported");
}k[b.ooID].bases=d;for(var m,h=d.length-1;0<=h;--h)(m=n[d[h].inherit])&&l[b.ooID].supers.push(m);f.prototype=Object.create(a[d[0].inherit].prototype);K(b.ooID)}Object.defineProperty(f.prototype,"constructor",{configurable:!0,value:f});Object.defineProperty(f.prototype,"Public",{configurable:!0,value:z});Object.defineProperty(f.prototype,"Protected",{configurable:!0,value:A});Object.defineProperty(f.prototype,"Private",{configurable:!0,value:B});Object.defineProperty(f.prototype,"Super",{configurable:!0,
value:L});Object.defineProperty(f.prototype,"Virtual",{configurable:!0,value:M});e.prototype=Object.create(f.prototype);return b}function K(a){a=k[a];for(var c=a.accessibleBases,d=a.inaccessibleBases,b=a.allBases,e=[],f=a.bases.length-1;0<=f;--f){var h=a.bases[f].inherit,g=n[h];if(g)for(c.push(h),b.push(h),e.push.apply(c,k[g].accessibleBases),e.push.apply(d,k[g].inaccessibleBases),e.push.apply(b,k[g].allBases),h=k[g].bases.length-1;0<=h;--h){var l=k[g].bases[h],p=c.indexOf(l.inherit);"private"===
l.as&&-1!==p&&e.push.apply(d,a.accessibleBases.splice(p,1))}}}function z(){return v.call(this,arguments,g.PUBLIC)}function A(){v.call(this,arguments,g.PROTECTED)}function B(){v.call(this,arguments,g.PRIVATE)}function I(){var a=k[l[this.ooID].classID];this===a.Static&&(a.friends=[].concat(Array.prototype.slice.call(arguments,0,arguments.length)))}function J(a){if(this!==k[l[this.ooID].classID].Static)return null;var c=[];a=a.ooID;for(var d=!1,b=null;a=w(a,this.ooID,!0,d);)c.unshift(l[a]._this),d=!0;
if(1===c.length)return c.pop();if(1<c.length)for(var b=c.reduce(q,{}),e=c.length-1;0<=e;--e){var f=k[l[c[e].ooID].classID];b[f.name]&&(q(b[f.name],c[e],!0),f[f.Static===c[e]?"staticLayout":"instanceLayout"].each(function(){this.flags&g.VIRTUAL&&Object.defineProperty(b[f.name],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return a.bind(b)}}(this.reference,c[e])})}))}return b}function N(a){return k[l[a.ooID].classID].name}function M(){v.call(this,arguments,g.VIRTUAL);
var a=Array.prototype.slice.apply(arguments);a[a.length]=g.VIRTUAL;return a}function L(){if(l[this.ooID]&&l[this.ooID].flags&g.SUPERS)throw Error("This object already has a parent. You have to call Super before calling Public, Private or Protected.");this.ooID===p&&C.call(this);D.apply(this,arguments)}function D(){if(!(l[this.ooID].flags&g.SUPERS)){l[this.ooID].flags|=g.SUPERS;for(var a=k[l[this.ooID].classID],c=a.bases.length-1;0<=c;--c){var d=a.bases[c].inherit;n[d]&&(E.prototype=a.namespace[d].prototype,
d=new E(a.namespace[d],arguments),l[this.ooID].supers.push(d.ooID))}}}function E(a,c){return a.apply(this,c)}function O(a,c,d){var b=c.classID;this.flags&g.PRIVATE?this.ownerID!==b&&-1!==d.classMeta.accessibleBases.indexOf(k[this.ownerID].name)&&delete a[k[this.ownerID].name][this.name]:(this.ownerID!==b&&k[b][d.layoutType].get(this.name,b)||Object.defineProperty(a,this.name,Object.getOwnPropertyDescriptor(c._this,this.name)),-1!==d.classMeta.inaccessibleBases.indexOf(k[this.ownerID].name)&&(d=n[this.ownerID],
a[d]=a[d]||{},Object.defineProperty(a[d],this.name,Object.getOwnPropertyDescriptor(c._this[d],this.name))))}function v(a,c){this.ooID===p&&C.call(this);var d=k[l[this.ooID].classID].Static===this?"staticLayout":"instanceLayout",b=l[this.ooID],e=b.classID,b={instRec:b,classID:e,supers:b.supers,iFace:b.iFace,classMeta:k[e],virtuals:k[e].virtuals,layout:k[e][d],layoutFlag:k[e].Static===this?g.INHERITED_STATIC:g.INHERITED_INSTANCE,layoutType:d,accessLvl:c,newMembers:[]};if(!(b.instRec.flags&g.STORED)){l[this.ooID].flags|=
g.STORED;for(var f in this)this.hasOwnProperty(f)&&(b.layout.get(f,b.classID)===p&&b.layout.set({name:f,flags:g.PRIVATE|g.ACTIVE,ownerID:b.classID,setterID:b.classID}),b.instRec.state[f]=this[f],delete this[f])}"instanceLayout"===d&&D.call(this);if(!(0===b.classMeta.bases.length||b.instRec.flags&g.BASE_ACCESSORS)){b.instRec.flags|=g.BASE_ACCESSORS;f=l[b.supers[0]];for(var h=k[b.instRec.classID].accessibleBases,e=h.length-1;0<=e;--e)k[f.classID].name!==h[e]&&(this[h[e]]=q({},f._this[h[e]],!0));k[f.classID][b.layoutType].each(O,
this,f,b);h=k[f.classID].name;this[h]=q({},this,!0);for(e=b.classMeta.bases.length-1;0<=e;--e)if(b.classMeta.bases[e].inherit===h&&"public"===b.classMeta.bases[e].as){q(b.iFace,f.iFace);b.iFace[h]=q({},f.iFace,!0);break}}if(!(b.classMeta.flags&b.layoutFlag))for(b.classMeta.flags|=b.layoutFlag,f=b.supers.length-1;0<=f;--f){var n=k[l[b.supers[f]].classID],e=n[b.layoutType],h=n.virtuals;e.each(P,b,n);for(var m in h)if(n=e.get(m),h.hasOwnProperty(m)&&(n===p||n.flags&g.VIRTUAL)){b.virtuals[m]=[];for(var r in h[m])b.virtuals[m].push(h[m][r])}}if(null===
b.classMeta.layoutInstance||this.ooID===b.classMeta.layoutInstance)for("instanceLayout"===d&&(b.classMeta.layoutInstance=this.ooID),r=a.length-1;0<=r;--r)if(m=a[r],Array.isArray(m)&&m[m.length-1]===g.VIRTUAL)for(f=m.length-2;0<=f;--f)F.call(this,b,m[f]);else F.call(this,b,m);if("instanceLayout"===d)for(r=a.length-1;0<=r;--r)if(m=a[r],"function"===typeof m&&(m=/\W*function\W+([\w\$]+)\(/.exec(m.toString())[1],b.virtuals[m]!==p))for(f=b.virtuals[m].length-1;0<=f;--f)b.virtuals[m][f].ownerID!==b.classID&&
Q.call(this,b,m,b.virtuals[m][f].ownerID);g.VIRTUAL!==c&&b.layout.each(R,this,b);if(c===g.PUBLIC&&"instanceLayout"===d)return b.iFace}function F(a,c){var d,b,e;if("function"===typeof c)b=/\W*function\W+([\w\$]+)\(/.exec(c.toString())[1],d=c;else if("string"===typeof c){var f=c.split(".");b=f.pop();e=f.pop();if(f.length)throw Error("More than one dot found in: "+c);if(e){if(!n[e])throw new TypeError(e+" is not an OoJs base. Setting access level is curently only supported on OoJs bases.");if(0>a.classMeta.accessibleBases.indexOf(e)&&
!a.layout.get(b,e))throw new TypeError(e+" is not an accessible base of "+a.classMeta.name);if(a.accessLvl===g.VIRTUAL)throw Error("Can't make base methods virtual ("+c+") in "+a.classMeta.name);}}else throw new TypeError("Parameters to this.Public/Private/Protected have to be either strings or references to functions. Got: "+c+" in class "+a.classMeta.name);var h,f=e||a.classMeta.name;if(h=a.layout.get(b,f))h=a.accessLvl&g.VIRTUAL?h.flags|g.VIRTUAL:a.accessLvl|h.flags&g.VIRTUAL;else if(d||e)h=a.accessLvl;
else throw Error("Couldn't find property: "+b+" in class: "+a.classMeta.name);e&&a.layout.get(b)&&a.layout.get(b).ownerID!==n[f]||(h|=g.ACTIVE);a.layout.set({name:b,reference:d,flags:h,ownerID:n[f],setterID:a.classID});a.accessLvl&g.VIRTUAL&&(a.virtuals[b]=a.virtuals[b]||[],a.virtuals[b].push(a.layout.get(b,a.classID)))}function P(a,c){if(!(this.flags&g.PRIVATE)&&this.flags&g.ACTIVE){for(var d,b=this.flags&~g.VIRTUAL,e=a.classMeta.bases.length-1;0<=e;--e)a.classMeta.bases[e].inherit===c.name&&(d=
a.classMeta.bases[e].as);if("private"===d||"protected"===d)d="private"===d?g.PRIVATE:g.PROTECTED,b&=~g.PUBLIC&~g.PROTECTED,b|=d;a.layout.set({name:this.name,ownerID:this.ownerID,setterID:this.setterID,reference:this.reference,flags:b})}}function Q(a,c,d){d=w(this.ooID,d);delete l[d]._this[c];Object.defineProperty(l[d]._this,c,{enumerable:!0,configurable:!0,get:function(a,c){return function(){return a.bind(c)}}(a.layout.get(c,a.classID).reference,this)})}function R(a,c){if(this.flags&c.accessLvl&&
this.setterID===c.classID)if(this.ownerID!==c.classID){var d=c.layout.get(this.name),b=c.layout.get(this.name,c.classID),e=k[this.ownerID].name;if(this.flags&g.PUBLIC)for(c.instRec.iFace[e]=c.instRec.iFace[e]||{},b=b?[c.instRec.iFace[e]]:[c.instRec.iFace,c.instRec.iFace[e]],d=b.length-1;0<=d;--d)Object.defineProperty(b[d],this.name,Object.getOwnPropertyDescriptor(c.instRec._this[e],this.name));else delete c.instRec.iFace[e][this.name],d&&d.ownerID===this.ownerID&&delete c.instRec.iFace[this.name]}else for(this.flags&
g.PUBLIC||delete c.instRec.iFace[this.name],e=this.flags&g.PUBLIC?[a,c.iFace]:[a],b=a.ooID,d=e.length-1;0<=d;--d)this.reference?Object.defineProperty(e[d],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return a.bind(b)}}(this.reference,a)}):Object.defineProperty(e[d],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return l[b].state[a]}}(this.name,b),set:function(a,b){return function(c){l[b].state[a]=c}}(this.name,b)})}function w(a,c,d,b){if(!b&&
(l[a].classID===c||d&&-1!==k[l[a].classID].friends.indexOf(k[c].name)))return a;for(var e=null,f,g=l[a].supers.length-1;f=l[a].supers[g];--g)if(f.classID===c||d&&-1!==k[l[f].classID].friends.indexOf(k[c].name)){e=f;break}else if(null!==(e=w(f,c,d,b)))break;return e}function C(){Object.defineProperty(this,"ooID",{value:u()});var a=new k[this.constructor.ooID].IFace;Object.defineProperty(a,"ooID",{value:this.ooID});l[this.ooID]=new y(this,this.constructor.ooID,a)}function u(){return++u.counter}function q(a,
c,d){for(var b in c)c.hasOwnProperty(b)&&(!0!==d||Object.getOwnPropertyDescriptor(c,b).get)&&Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b));return a}if(!x.OoJs){x.OoJs=t;var k={},l={},n={},g={PRIVATE:1,PROTECTED:2,PUBLIC:4,VIRTUAL:8,INHERITED_INSTANCE:16,INHERITED_STATIC:32,BASE_ACCESSORS:64,STORED:128,SUPERS:256,ACTIVE:512};s.prototype.get=function(a,c){a="OoJs__"+a;if(this.table[a]===p)return p;if(c===p)for(var d=this.table[a].length-1;0<=d;--d)if(this.table[a][d].flags&g.ACTIVE)return this.table[a][d];
"string"===typeof c&&(c=n[c]);for(d=this.table[a].length-1;0<=d;--d)if(this.table[a][d].ownerID===c)return this.table[a][d];return p};s.prototype.getAll=function(a){return this.table["OoJs__"+a]};s.prototype.setActive=function(a,c){console.assert(this.table[a]!==p);"string"===typeof c&&(c=n[c]);for(var d=this.table[a].length-1;0<=d;--d)this.table[a][d].flags=this.table[a][d].ownerID===c?this.table[a][d].flags|g.ACTIVE:this.table[a][d].flags&~g.ACTIVE};s.prototype.set=function(a){var c="OoJs__"+a.name;
console.assert(a.ownerID);console.assert(a.name);this.table[c]===p?this.table[c]=[a]:this.get(c.substring(6),a.ownerID)?q(this.get(c.substring(6),a.ownerID),a):this.table[c].push(a);a.flags&g.ACTIVE&&this.setActive(c,a.ownerID)};s.prototype.each=function(){var a=Array.prototype.splice.call(arguments,0,1).pop(),c=[],d;for(d in this.table)if(this.table.hasOwnProperty(d))for(var b=this.table[d].length-1;0<=b;--b)c.push(a.apply(this.table[d][b],arguments));return c};t.setupClass=H;t.typeOf=N;t.extend=
q;u.counter=0}})(TidBits);"undefined"!==typeof module&&(module.exports=TidBits);
