/*
 TidBits OoJs - version: 13.08.20-alpha
 README: https://github.com/najamelan/TidBits_Javascript_OoJs
*/
var TidBits=TidBits||{};
(function(y,q){function t(a,c){this.classID=a;this.type=c;this.table={}}function J(a,c,d,b,e){this.Static=c;this.IFace=e;this.Class=a[d];this.name=d;this.id=b;this.bases=[];this.allBases=[];this.accessibleBases=[];this.inaccessibleBases=[];this.friends=[];this.staticLayout=new t(c.ooID,"staticLayout");this.instanceLayout=new t(c.ooID,"instanceLayout");this.layoutInstance=null;this.flags=0;this.virtuals={};this.namespace=a}function z(a,c,d){this._this=a;this.classID=c;this.iFace=d;this.state={};this.supers=
[];this.flags=0}function u(){return null}function K(a,c,d){function b(){}function e(){}var h=a[c];Object.defineProperty(b,"Public",{value:A});Object.defineProperty(b,"Protected",{value:B});Object.defineProperty(b,"Private",{value:C});Object.defineProperty(b,"Friends",{value:L});Object.defineProperty(b,"getPrivateInstance",{value:M});Object.defineProperty(b,"ooID",{value:v()});Object.defineProperty(h,"ooID",{value:b.ooID});Object.defineProperty(b,"toString",{value:function(){return"function Static(){ /*"+
c+"*/ }"}});Object.defineProperty(h,"toString",{value:function(){return"function "+c+"()"}});k[b.ooID]=new J(a,b,c,b.ooID,e);l[b.ooID]=new z(b,b.ooID,h);n[c]=b.ooID;if(d!==q){Array.isArray(d)||(d=Array(d));for(var g=d.length-1;0<=g;--g){var f={as:"private",namespace:a};"string"===typeof d[g]&&(d[g]={inherit:d[g]});d[g]=r(f,d[g]);if(0>["public","private","protected"].indexOf(d[g].as))throw Error("Invalid class access level in class: "+c+". Trying to inherit "+d[g].inherit+" as "+d[g].as+". Only 'public', 'private' or 'protected' are supported");
}k[b.ooID].bases=d;for(var D,g=d.length-1;0<=g;--g)(D=n[d[g].inherit])&&l[b.ooID].supers.push(D);h.prototype=Object.create(a[d[0].inherit].prototype);N(b.ooID)}Object.defineProperty(h.prototype,"constructor",{configurable:!0,value:h});Object.defineProperty(h.prototype,"Public",{configurable:!0,value:A});Object.defineProperty(h.prototype,"Protected",{configurable:!0,value:B});Object.defineProperty(h.prototype,"Private",{configurable:!0,value:C});Object.defineProperty(h.prototype,"Super",{configurable:!0,
value:O});Object.defineProperty(h.prototype,"Virtual",{configurable:!0,value:P});e.prototype=Object.create(h.prototype);return b}function N(a){a=k[a];for(var c=a.accessibleBases,d=a.inaccessibleBases,b=a.allBases,e=[],h=a.bases.length-1;0<=h;--h){var g=a.bases[h].inherit,f=n[g];if(f)for(c.push(g),b.push(g),e.push.apply(c,k[f].accessibleBases),e.push.apply(d,k[f].inaccessibleBases),e.push.apply(b,k[f].allBases),g=k[f].bases.length-1;0<=g;--g){var l=k[f].bases[g],m=c.indexOf(l.inherit);"private"===
l.as&&-1!==m&&e.push.apply(d,a.accessibleBases.splice(m,1))}}}function A(){return w.call(this,arguments,f.PUBLIC)}function B(){w.call(this,arguments,f.PROTECTED)}function C(){w.call(this,arguments,f.PRIVATE)}function L(){var a=k[l[this.ooID].classID];this===a.Static&&(a.friends=[].concat(Array.prototype.slice.call(arguments,0,arguments.length)))}function M(a){if(this!==k[l[this.ooID].classID].Static)return null;var c=[];a=a.ooID;for(var d=!1,b=null;a=x(a,this.ooID,!0,d);)c.unshift(l[a]._this),d=!0;
if(1===c.length)return c.pop();if(1<c.length)for(var b=c.reduce(r,{}),e=c.length-1;0<=e;--e){var h=k[l[c[e].ooID].classID];b[h.name]&&(r(b[h.name],c[e],!0),h[h.Static===c[e]?"staticLayout":"instanceLayout"].each(function(){this.flags&f.VIRTUAL&&Object.defineProperty(b[h.name],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return a.bind(b)}}(this.reference,c[e])})}))}return b}function Q(a){return k[l[a.ooID].classID].name}function P(){w.call(this,arguments,f.VIRTUAL);
var a=Array.prototype.slice.apply(arguments);a[a.length]=f.VIRTUAL;return a}function O(){if(l[this.ooID]&&l[this.ooID].flags&f.SUPERS)throw Error("This object already has a parent. You have to call Super before calling Public, Private or Protected.");this.ooID===q&&E.call(this);F.apply(this,arguments)}function F(){if(!(l[this.ooID].flags&f.SUPERS)){l[this.ooID].flags|=f.SUPERS;for(var a=k[l[this.ooID].classID],c=a.bases.length-1;0<=c;--c){var d=a.bases[c].inherit;n[d]&&(G.prototype=a.namespace[d].prototype,
d=new G(a.namespace[d],arguments),l[this.ooID].supers.push(d.ooID))}}}function G(a,c){return a.apply(this,c)}function R(a,c,d){var b=c.classID;this.flags&f.PRIVATE?this.ownerID!==b&&-1!==d.classMeta.accessibleBases.indexOf(k[this.ownerID].name)&&delete a[k[this.ownerID].name][this.name]:(this.ownerID!==b&&k[b][d.layoutType].get(this.name,b)||Object.defineProperty(a,this.name,Object.getOwnPropertyDescriptor(c._this,this.name)),-1!==d.classMeta.inaccessibleBases.indexOf(k[this.ownerID].name)&&(d=n[this.ownerID],
a[d]=a[d]||{},Object.defineProperty(a[d],this.name,Object.getOwnPropertyDescriptor(c._this[d],this.name))))}function w(a,c){this.ooID===q&&E.call(this);var d=k[l[this.ooID].classID].Static===this?"staticLayout":"instanceLayout",b=l[this.ooID],e=b.classID,b={instRec:b,classID:e,supers:b.supers,iFace:b.iFace,classMeta:k[e],virtuals:k[e].virtuals,layout:k[e][d],layoutFlag:k[e].Static===this?f.INHERITED_STATIC:f.INHERITED_INSTANCE,layoutType:d,accessLvl:c,newMembers:[]},h;if(b.instRec.flags&f.STORED)h=
void 0;else{l[this.ooID].flags|=f.STORED;for(h in this)this.hasOwnProperty(h)&&(b.layout.get(h,b.classID)===q&&b.layout.set({name:h,flags:f.PRIVATE|f.ACTIVE,ownerID:b.classID,setterID:b.classID}),b.instRec.state[h]=this[h],delete this[h]);h=!0}"instanceLayout"===d&&F.call(this);if(!(0===b.classMeta.bases.length||b.instRec.flags&f.BASE_ACCESSORS)){b.instRec.flags|=f.BASE_ACCESSORS;for(var e=l[b.supers[0]],g=k[b.instRec.classID].accessibleBases,p=g.length-1;0<=p;--p)k[e.classID].name!==g[p]&&(this[g[p]]=
r({},e._this[g[p]],!0));k[e.classID][b.layoutType].each(R,this,e,b);g=k[e.classID].name;this[g]=r({},this,!0);for(p=b.classMeta.bases.length-1;0<=p;--p)if(b.classMeta.bases[p].inherit===g&&"public"===b.classMeta.bases[p].as){r(b.iFace,e.iFace);b.iFace[g]=r({},e.iFace,!0);break}}if(!(b.classMeta.flags&b.layoutFlag))for(b.classMeta.flags|=b.layoutFlag,e=b.supers.length-1;0<=e;--e){var n=k[l[b.supers[e]].classID],p=n[b.layoutType],g=n.virtuals;p.each(S,b,n);for(var m in g)if(n=p.get(m),g.hasOwnProperty(m)&&
(n===q||n.flags&f.VIRTUAL)){b.virtuals[m]=[];for(var s in g[m])b.virtuals[m].push(g[m][s])}}if(null===b.classMeta.layoutInstance||this.ooID===b.classMeta.layoutInstance)for("instanceLayout"===d&&(b.classMeta.layoutInstance=this.ooID),s=a.length-1;0<=s;--s)if(m=a[s],Array.isArray(m)&&m[m.length-1]===f.VIRTUAL)for(e=m.length-2;0<=e;--e)H.call(this,b,m[e]);else H.call(this,b,m);if("instanceLayout"===d)for(s=a.length-1;0<=s;--s)if(m=a[s],"function"===typeof m&&(m=/\W*function\W+([\w\$]+)\(/.exec(m.toString())[1],
b.virtuals[m]!==q))for(e=b.virtuals[m].length-1;0<=e;--e)b.virtuals[m][e].ownerID!==b.classID&&T.call(this,b,m,b.virtuals[m][e].ownerID);f.VIRTUAL!==c&&b.layout.each(I,this,b);!h||c&f.PRIVATE||(b.accessLvl=f.PRIVATE,b.layout.each(I,this,b));if(c===f.PUBLIC&&"instanceLayout"===d)return b.iFace}function H(a,c){var d,b,e;if("function"===typeof c)b=/\W*function\W+([\w\$]+)\(/.exec(c.toString())[1],d=c;else if("string"===typeof c){var h=c.split(".");b=h.pop();e=h.pop();if(h.length)throw Error("More than one dot found in: "+
c);if(e){if(!n[e])throw new TypeError(e+" is not an OoJs base. Setting access level is curently only supported on OoJs bases.");if(0>a.classMeta.accessibleBases.indexOf(e)&&!a.layout.get(b,e))throw new TypeError(e+" is not an accessible base of "+a.classMeta.name);if(a.accessLvl===f.VIRTUAL)throw Error("Can't make base methods virtual ("+c+") in "+a.classMeta.name);}}else throw new TypeError("Parameters to this.Public/Private/Protected have to be either strings or references to functions. Got: "+
c+" in class "+a.classMeta.name);var g,h=e||a.classMeta.name;if(g=a.layout.get(b,h))g=a.accessLvl&f.VIRTUAL?g.flags|f.VIRTUAL:a.accessLvl|g.flags&f.VIRTUAL;else if(d||e)g=a.accessLvl;else throw Error("Couldn't find property: "+b+" in class: "+a.classMeta.name);e&&a.layout.get(b)&&a.layout.get(b).ownerID!==n[h]||(g|=f.ACTIVE);a.layout.set({name:b,reference:d,flags:g,ownerID:n[h],setterID:a.classID});a.accessLvl&f.VIRTUAL&&(a.virtuals[b]=a.virtuals[b]||[],a.virtuals[b].push(a.layout.get(b,a.classID)))}
function S(a,c){if(!(this.flags&f.PRIVATE)&&this.flags&f.ACTIVE){for(var d,b=this.flags&~f.VIRTUAL,e=a.classMeta.bases.length-1;0<=e;--e)a.classMeta.bases[e].inherit===c.name&&(d=a.classMeta.bases[e].as);if("private"===d||"protected"===d)d="private"===d?f.PRIVATE:f.PROTECTED,b&=~f.PUBLIC&~f.PROTECTED,b|=d;a.layout.set({name:this.name,ownerID:this.ownerID,setterID:this.setterID,reference:this.reference,flags:b})}}function T(a,c,d){d=x(this.ooID,d);delete l[d]._this[c];Object.defineProperty(l[d]._this,
c,{enumerable:!0,configurable:!0,get:function(a,c){return function(){return a.bind(c)}}(a.layout.get(c,a.classID).reference,this)})}function I(a,c){if(this.flags&c.accessLvl&&this.setterID===c.classID)if(this.ownerID!==c.classID){var d=c.layout.get(this.name),b=c.layout.get(this.name,c.classID),e=k[this.ownerID].name;if(this.flags&f.PUBLIC)for(c.instRec.iFace[e]=c.instRec.iFace[e]||{},b=b?[c.instRec.iFace[e]]:[c.instRec.iFace,c.instRec.iFace[e]],d=b.length-1;0<=d;--d)Object.defineProperty(b[d],this.name,
Object.getOwnPropertyDescriptor(c.instRec._this[e],this.name));else delete c.instRec.iFace[e][this.name],d&&d.ownerID===this.ownerID&&delete c.instRec.iFace[this.name]}else for(this.flags&f.PUBLIC||delete c.instRec.iFace[this.name],e=this.flags&f.PUBLIC?[a,c.iFace]:[a],b=a.ooID,d=e.length-1;0<=d;--d)this.reference?Object.defineProperty(e[d],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return a.bind(b)}}(this.reference,a)}):Object.defineProperty(e[d],this.name,{enumerable:!0,
configurable:!0,get:function(a,b){return function(){return l[b].state[a]}}(this.name,b),set:function(a,b){return function(c){l[b].state[a]=c}}(this.name,b)})}function x(a,c,d,b){if(!b&&(l[a].classID===c||d&&-1!==k[l[a].classID].friends.indexOf(k[c].name)))return a;for(var e=null,f,g=l[a].supers.length-1;f=l[a].supers[g];--g)if(f.classID===c||d&&-1!==k[l[f].classID].friends.indexOf(k[c].name)){e=f;break}else if(null!==(e=x(f,c,d,b)))break;return e}function E(){Object.defineProperty(this,"ooID",{value:v()});
var a=new k[this.constructor.ooID].IFace;Object.defineProperty(a,"ooID",{value:this.ooID});l[this.ooID]=new z(this,this.constructor.ooID,a)}function v(){return++v.counter}function r(a,c,d){for(var b in c)c.hasOwnProperty(b)&&(!0!==d||Object.getOwnPropertyDescriptor(c,b).get)&&Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b));return a}if(!y.OoJs){y.OoJs=u;var k={},l={},n={},f={PRIVATE:1,PROTECTED:2,PUBLIC:4,VIRTUAL:8,INHERITED_INSTANCE:16,INHERITED_STATIC:32,BASE_ACCESSORS:64,STORED:128,
SUPERS:256,ACTIVE:512};t.prototype.get=function(a,c){a="OoJs__"+a;if(this.table[a]===q)return q;if(c===q)for(var d=this.table[a].length-1;0<=d;--d)if(this.table[a][d].flags&f.ACTIVE)return this.table[a][d];"string"===typeof c&&(c=n[c]);for(d=this.table[a].length-1;0<=d;--d)if(this.table[a][d].ownerID===c)return this.table[a][d];return q};t.prototype.getAll=function(a){return this.table["OoJs__"+a]};t.prototype.setActive=function(a,c){console.assert(this.table[a]!==q);"string"===typeof c&&(c=n[c]);
for(var d=this.table[a].length-1;0<=d;--d)this.table[a][d].flags=this.table[a][d].ownerID===c?this.table[a][d].flags|f.ACTIVE:this.table[a][d].flags&~f.ACTIVE};t.prototype.set=function(a){var c="OoJs__"+a.name;console.assert(a.ownerID);console.assert(a.name);this.table[c]===q?this.table[c]=[a]:this.get(c.substring(6),a.ownerID)?r(this.get(c.substring(6),a.ownerID),a):this.table[c].push(a);a.flags&f.ACTIVE&&this.setActive(c,a.ownerID)};t.prototype.each=function(){var a=Array.prototype.splice.call(arguments,
0,1).pop(),c=[],d;for(d in this.table)if(this.table.hasOwnProperty(d))for(var b=this.table[d].length-1;0<=b;--b)c.push(a.apply(this.table[d][b],arguments));return c};u.setupClass=K;u.typeOf=Q;u.extend=r;v.counter=0}})(TidBits);"undefined"!==typeof module&&(module.exports=TidBits);
