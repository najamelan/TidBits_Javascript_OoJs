/*
 TidBits OoJs - version: 13.08.14-alpha
 README: https://github.com/najamelan/TidBits_Javascript_OoJs
*/
var TidBits=TidBits||{};
(function(x,n){function r(b,c){this.classID=b;this.type=c;this.table={}}function G(b,c,d,a,f){this.Static=c;this.IFace=f;this.Class=b[d];this.name=d;this.id=a;this.bases=[];this.allBases=[];this.accessibleBases=[];this.inaccessibleBases=[];this.staticLayout=new r(c.ooID,"staticLayout");this.instanceLayout=new r(c.ooID,"instanceLayout");this.layoutInstance=null;this.flags=0;this.virtuals={};this.namespace=b}function y(b,c,d){this._this=b;this.classID=c;this.iFace=d;this.state={};this.supers=[];this.flags=
0}function v(){return null}function H(b,c,d){function a(){}function f(){}var e=b[c];Object.defineProperty(a,"Public",{value:z});Object.defineProperty(a,"Protected",{value:A});Object.defineProperty(a,"Private",{value:B});Object.defineProperty(a,"getPrivateInstance",{value:I});Object.defineProperty(a,"ooID",{value:t()});Object.defineProperty(e,"ooID",{value:a.ooID});Object.defineProperty(a,"toString",{value:function(){return"function Static(){ /*"+c+"*/ }"}});Object.defineProperty(e,"toString",{value:function(){return"function "+
c+"()"}});l[a.ooID]=new G(b,a,c,a.ooID,f);k[a.ooID]=new y(a,a.ooID,e);p[c]=a.ooID;if(d!==n){Array.isArray(d)||(d=Array(d));for(var g=d.length-1;0<=g;--g){var m={as:"public",namespace:b};"string"===typeof d[g]&&(d[g]={inherit:d[g]});d[g]=s(m,d[g]);if(0>["public","private","protected"].indexOf(d[g].as))throw Error("Invalid class access level in class: "+c+". Trying to inherit "+d[g].inherit+" as "+d[g].as+". Only 'public', 'private' or 'protected' are supported");}l[a.ooID].bases=d;for(var h,g=d.length-
1;0<=g;--g)(h=p[d[g].inherit])&&k[a.ooID].supers.push(h);e.prototype=Object.create(b[d[0].inherit].prototype);J(a.ooID)}Object.defineProperty(e.prototype,"constructor",{configurable:!0,value:e});Object.defineProperty(e.prototype,"Public",{configurable:!0,value:z});Object.defineProperty(e.prototype,"Protected",{configurable:!0,value:A});Object.defineProperty(e.prototype,"Private",{configurable:!0,value:B});Object.defineProperty(e.prototype,"Super",{configurable:!0,value:K});Object.defineProperty(e.prototype,
"Virtual",{configurable:!0,value:L});f.prototype=Object.create(e.prototype);return a}function J(b){b=l[b];for(var c=b.accessibleBases,d=b.inaccessibleBases,a=b.allBases,f=[],e=b.bases.length-1;0<=e;--e){var g=b.bases[e].inherit,h=p[g];if(h)for(c.push(g),a.push(g),f.push.apply(c,l[h].accessibleBases),f.push.apply(d,l[h].inaccessibleBases),f.push.apply(a,l[h].allBases),g=l[h].bases.length-1;0<=g;--g){var k=l[h].bases[g],n=c.indexOf(k.inherit);"private"===k.as&&-1!==n&&f.push.apply(d,b.accessibleBases.splice(n,
1))}}}function z(){return u.call(this,arguments,h.PUBLIC)}function A(){u.call(this,arguments,h.PROTECTED)}function B(){u.call(this,arguments,h.PRIVATE)}function I(b){var c;return this!==l[k[this.ooID].classID].Static?null:(c=w(b.ooID,this.ooID))?k[c]._this:null}function M(b){return l[k[b.ooID].classID].name}function L(){u.call(this,arguments,h.VIRTUAL);var b=Array.prototype.slice.apply(arguments);b[b.length]=h.VIRTUAL;return b}function K(){if(k[this.ooID]&&k[this.ooID].flags&h.SUPERS)throw Error("This object already has a parent. You have to call Super before calling Public, Private or Protected.");
this.ooID===n&&C.call(this);D.apply(this,arguments)}function D(){if(!(k[this.ooID].flags&h.SUPERS)){k[this.ooID].flags|=h.SUPERS;for(var b=l[k[this.ooID].classID],c=b.bases.length-1;0<=c;--c){var d=b.bases[c].inherit;p[d]&&(E.prototype=b.namespace[d].prototype,d=new E(b.namespace[d],arguments),k[this.ooID].supers.push(d.ooID))}}}function E(b,c){return b.apply(this,c)}function N(b,c,d){var a=c.classID;this.flags&h.PRIVATE?this.ownerID!==a&&-1!==d.classMeta.accessibleBases.indexOf(l[this.ownerID].name)&&
delete b[l[this.ownerID].name][this.name]:(this.ownerID!==a&&l[a][d.layoutType].get(this.name,a)||Object.defineProperty(b,this.name,Object.getOwnPropertyDescriptor(c._this,this.name)),-1!==d.classMeta.inaccessibleBases.indexOf(l[this.ownerID].name)&&(d=p[this.ownerID],b[d]=b[d]||{},Object.defineProperty(b[d],this.name,Object.getOwnPropertyDescriptor(c._this[d],this.name))))}function u(b,c){this.ooID===n&&C.call(this);var d=l[k[this.ooID].classID].Static===this?"staticLayout":"instanceLayout",a=k[this.ooID],
f=a.classID,a={instRec:a,classID:f,supers:a.supers,iFace:a.iFace,classMeta:l[f],virtuals:l[f].virtuals,layout:l[f][d],layoutFlag:l[f].Static===this?h.INHERITED_STATIC:h.INHERITED_INSTANCE,layoutType:d,accessLvl:c,newMembers:[]};if(!(a.instRec.flags&h.STORED)){k[this.ooID].flags|=h.STORED;for(var e in this)this.hasOwnProperty(e)&&(a.layout.get(e,a.classID)===n&&a.layout.set({name:e,reference:null,flags:h.PRIVATE,ownerID:a.classID,setterID:a.classID}),a.instRec.state[e]=this[e],delete this[e])}"instanceLayout"===
d&&D.call(this);if(!(0===a.classMeta.bases.length||a.instRec.flags&h.BASE_ACCESS)){a.instRec.flags|=h.BASE_ACCESS;e=k[a.supers[0]];for(var g=l[a.instRec.classID].accessibleBases,f=g.length-1;0<=f;--f)l[e.classID].name!==g[f]&&Object.defineProperty(this,g[f],Object.getOwnPropertyDescriptor(e._this,g[f]));l[e.classID][a.layoutType].each(N,this,e,a);g=l[e.classID].name;this[g]=s({},this,!0);this[g].ooID=e._this.ooID;for(f=a.classMeta.bases.length-1;0<=f;--f)if(a.classMeta.bases[f].inherit===g&&"public"===
a.classMeta.bases[f].as){s(a.iFace,e.iFace);a.iFace[g]=s({},e.iFace,!0);a.iFace[g].ooID=e._this.ooID;break}}if(!(a.classMeta.flags&a.layoutFlag))for(a.classMeta.flags|=a.layoutFlag,e=a.supers.length-1;0<=e;--e){g=l[k[a.supers[e]].classID];f=g[a.layoutType];g=g.virtuals;f.each(O,a);for(var m in g){var p=f.get(m);if(g.hasOwnProperty(m)&&(p===n||p.flags&h.VIRTUAL)){a.virtuals[m]=[];for(var q in g[m])a.virtuals[m].push(g[m][q])}}}if(null===a.classMeta.layoutInstance||this.ooID===a.classMeta.layoutInstance)for("instanceLayout"===
d&&(a.classMeta.layoutInstance=this.ooID),q=b.length-1;0<=q;--q)if(m=b[q],Array.isArray(m)&&m[m.length-1]===h.VIRTUAL)for(e=m.length-2;0<=e;--e)F.call(this,a,m[e]);else F.call(this,a,m);if("instanceLayout"===d)for(q=b.length-1;0<=q;--q)if(m=b[q],"function"===typeof m&&(m=/\W*function\W+([\w\$]+)\(/.exec(m.toString())[1],a.virtuals[m]!==n))for(e=a.virtuals[m].length-1;0<=e;--e)a.virtuals[m][e].ownerID!==a.classID&&P.call(this,a,m,a.virtuals[m][e].ownerID);h.VIRTUAL!==c&&a.layout.each(Q,this,a);if(c===
h.PUBLIC&&"instanceLayout"===d)return a.iFace}function F(b,c){var d,a,f;if("function"===typeof c)a=/\W*function\W+([\w\$]+)\(/.exec(c.toString())[1],d=c;else if("string"===typeof c){var e=c.split(".");a=e.pop();f=e.pop();if(e.length)throw Error("More than one dot found in: "+c);if(f){if(!p[f])throw new TypeError(f+" is not an OoJs base. Setting access level is curently only supported on OoJs bases.");if(0>b.classMeta.accessibleBases.indexOf(f)&&!b.layout.get(a,f))throw new TypeError(f+" is not an accessible base of "+
b.classMeta.name);if(b.accessLvl===h.VIRTUAL)throw Error("Can't make base methods virtual ("+c+") in "+b.classMeta.name);}}else throw new TypeError("Parameters to this.Public/Private/Protected have to be either strings or references to functions. Got: "+c+" in class "+b.classMeta.name);f=f||b.classMeta.name;if(e=b.layout.get(a,f))e=b.accessLvl&h.VIRTUAL?e.flags|h.VIRTUAL:b.accessLvl|e.flags&h.VIRTUAL;else if(d||f!==b.classMeta.name)e=b.accessLvl;else throw Error("Couldn't find property: "+a+" in class: "+
b.classMeta.name);b.layout.set({name:a,reference:d,flags:e,ownerID:p[f],setterID:b.classID});b.accessLvl&h.VIRTUAL&&(b.virtuals[a]=b.virtuals[a]||[],b.virtuals[a].push(b.layout.get(a,b.classID)))}function O(b){this.flags&h.PRIVATE||b.layout.set({name:this.name,ownerID:this.ownerID,reference:this.reference,flags:this.flags&~h.VIRTUAL})}function P(b,c,d){d=w(this.ooID,d);delete k[d]._this[c];Object.defineProperty(k[d]._this,c,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return a.bind(b)}}(b.layout.get(c,
b.classID).reference,this)})}function Q(b,c){if(this.flags&c.accessLvl&&this.setterID===c.classID)if(this.ownerID!==c.classID){var d=c.layout.get(this.name,c.classID),a=l[this.ownerID].name;if(this.flags&h.PUBLIC){c.instRec.iFace[a]=c.instRec.iFace[a]||{};for(var f=d?[c.instRec.iFace[a]]:[c.instRec.iFace,c.instRec.iFace[a]],d=f.length-1;0<=d;--d)Object.defineProperty(f[d],this.name,Object.getOwnPropertyDescriptor(c.instRec._this[a],this.name))}else delete c.instRec.iFace[a][this.name],d&&d.flags&
h.PUBLIC||delete c.instRec.iFace[this.name]}else for(a=this.flags&h.PUBLIC?[b,c.iFace]:[b],f=b.ooID,d=a.length-1;0<=d;--d)this.reference?Object.defineProperty(a[d],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return a.bind(b)}}(this.reference,b)}):Object.defineProperty(a[d],this.name,{enumerable:!0,configurable:!0,get:function(a,b){return function(){return k[b].state[a]}}(this.name,f),set:function(a,b){return function(c){k[b].state[a]=c}}(this.name,f)})}function w(b,
c){if(k[b].classID===c)return b;for(var d=null,a,f=k[b].supers.length-1;a=k[b].supers[f];--f)if(a.classID===c){d=a;break}else if(null!==(d=w(a,c)))break;return d}function C(){Object.defineProperty(this,"ooID",{value:t()});var b=new l[this.constructor.ooID].IFace;Object.defineProperty(b,"ooID",{value:this.ooID});k[this.ooID]=new y(this,this.constructor.ooID,b)}function t(){return++t.counter}function s(b,c,d){for(var a in c)!c.hasOwnProperty(a)||!Object.getOwnPropertyDescriptor(c,a).get&&d||Object.defineProperty(b,
a,Object.getOwnPropertyDescriptor(c,a));return b}if(!x.OoJs){x.OoJs=v;var l={},k={},p={},h={PRIVATE:2,PROTECTED:4,PUBLIC:8,VIRTUAL:16,INHERITED_INSTANCE:32,INHERITED_STATIC:64,BASE_ACCESS:128,STORED:256,SUPERS:512};r.prototype.get=function(b,c){if(this.table[b]===n)return n;"string"===typeof c&&(c=p[c]);if(c===n&&1===this.table[b].length)return this.table[b][0];for(var d={},a=this.table[b].length-1;0<=a;--a)d[this.table[b][a].ownerID]=a;c=c||this.classID;return d[c]!==n?this.table[b][d[c]]:n};r.prototype.set=
function(b){console.assert(b.ownerID);console.assert(b.name);var c=b.name;if(this.table[c]===n)this.table[c]=[b];else{for(var d=this.table[c].length-1;0<=d;--d)if(this.table[c][d].ownerID===b.ownerID){s(this.table[c][d],b);return}this.table[c].push(b)}};r.prototype.each=function(){var b=Array.prototype.splice.call(arguments,0,1).pop(),c=[],d;for(d in this.table)if(this.table.hasOwnProperty(d))for(var a=this.table[d].length-1;0<=a;--a)c.push(b.apply(this.table[d][a],arguments));return c};v.setupClass=
H;v.typeOf=M;t.counter=0}})(TidBits);"undefined"!==typeof module&&(module.exports.OoJs=TidBits.OoJs);
